import telebot
from config import TOKEN, currencies, signs
from extensions import APIException, Convert

bot = telebot.TeleBot(TOKEN) # –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –±–æ—Ç–∞

@bot.message_handler(commands=['start', 'help']) # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥ /start –∏ /help
def hello_message(message): # –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞
    text = '''–ü—Ä–∏–≤–µ—Ç, –ø–æ–º–æ–≥—É —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π –≤–∞–ª—é—Ç! üëã
–í–≤–µ–¥–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ <–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é —ç—Ç–æ> <–≤ —ç—Ç–æ> <–≤ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ> —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª.
–ù–∞–ø—Ä–∏–º–µ—Ä: *–î–æ–ª–ª–∞—Ä –†—É–±–ª—å 1*

*–°–ø–∏—Å–æ–∫ –≤–∞–ª—é—Ç –ø–æ –∫–Ω–æ–ø–∫–µ /values*
'''
    bot.send_message(message.chat.id, text, parse_mode='Markdown') # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º Markdown

@bot.message_handler(commands=['values']) # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /values
def list_of_currencies(message):
    text = 'üìã *–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∞–ª—é—Ç:*\n\n'
    text += "\n".join(currencies.keys()) # –í—ã–≤–æ–¥ –≤–∞–ª—é—Ç –∏–∑ —Å–ª–æ–≤–∞—Ä—è –≤ —Ñ–∞–π–ª–µ config.py

    bot.send_message(message.chat.id, text, parse_mode='Markdown')

@bot.message_handler(content_types=['text', ]) # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Ç–µ–∫—Å—Ç–æ–º.
def convert(message):
    try:
        values = message.text.split(' ') # –î–æ—Å—Ç–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        if len(values) != 3: # –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ–±—ã –±—ã–ª–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª-–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            raise APIException('–ù–µ–≤–µ—Ä–Ω–æ–µ –∫–æ–ª-–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤')

        base, quote, amount = values # –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
        base, quote = base.capitalize(), quote.capitalize() # –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–≤–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ –ª—é–±–æ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ
        result = Convert.get_price(base, quote, amount) # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é –∫–ª–∞—Å—Å–∞ Convert –∏ —Ñ—É–Ω–∫—Ü–∏–∏ get_price()

    except APIException as e: # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–µ —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π
        bot.reply_to(message, f'‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *{type(e).__name__}:*\n_{e}_', parse_mode='Markdown') # –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–∏–ø–æ–º –æ—à–∏–±–∫–∏ –∏ –µ–µ —Ç–µ–∫—Å—Ç–æ–º

    except Exception as e: # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫
        bot.send_message(message.chat.id, f'‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ *{type(e).__name__}:*\n_{e}_', parse_mode='Markdown')

    else: # –ï—Å–ª–∏ –≤—Å—ë —Ö–æ—Ä–æ—à–æ, –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º –¥–æ 4-—Ö —Å–∏–º–≤–æ–ª–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
        text = f'''–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è *{base}* ‚Äî> *{quote}*
–ö–æ–ª-–≤–æ –≤–∞–ª—é—Ç—ã: *{signs[base]}{amount}*

–ò—Ç–æ–≥–æ: *{signs[base]}{amount} = {signs[quote]}{round(result, 4)}*
'''
        bot.send_message(message.chat.id, text, parse_mode='Markdown')

bot.polling(none_stop=True) # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

